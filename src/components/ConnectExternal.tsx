import { useState } from 'react';
import { useWallet } from '../context/WalletContext';

export default function ConnectExternal() {
    const { connectMetaMask } = useWallet();
    const [isConnecting, setIsConnecting] = useState(false);
    const [error, setError] = useState('');

    const handleConnectMetaMask = async () => {
        setError('');
        setIsConnecting(true);

        try {
            await connectMetaMask();
        } catch (err) {
            setError(err instanceof Error ? err.message : 'Failed to connect');
        } finally {
            setIsConnecting(false);
        }
    };

    const hasMetaMask = typeof window !== 'undefined' && window.ethereum?.isMetaMask;

    return (
        <div className="space-y-3">
            {hasMetaMask ? (
                <button
                    onClick={handleConnectMetaMask}
                    disabled={isConnecting}
                    className="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white font-semibold rounded-lg transition-colors disabled:opacity-50"
                >
                    <img
                        src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjM1NSIgdmlld0JveD0iMCAwIDM5NyAzNTUiIHdpZHRoPSIzOTciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMSAtMSkiPjxwYXRoIGQ9Im0xMTQuNjIyNjQ0IDMyNy4xOTU0NzIgNTIuMDA0NzE3IDEzLjgxMDE5OHYtMTguMDU5NDlsNC4yNDUyODMtNC4yNDkyOTJoMjkuNzE2OTgydjIxLjI0NjQ1OSAyOS43MTY5ODFsLTM4LjIwNzU0OC0xNS44NzI2NDV6IiBmaWxsPSIjY2RiZGI1Ii8+PHBhdGggZD0ibTIwOS4zOTYyMjcgMzI3LjE5NTQ3Mi01Mi4wMDQ3MTcgMTMuODEwMTk4di0xOC4wNTk0OWwtNC4yNDUyODQtNC4yNDkyOTJoLTI5LjcxNjk4MXYyMS4yNDY0NTkgMjkuNzE2OTgxbDM4LjIwNzU0OC0xNS44NzI2NDV6IiBmaWxsPSIjY2RiZGI1IiB0cmFuc2Zvcm09Im1hdHJpeCgtMSAwIDAgMSA0MDguNjU2IDApIi8+PHBhdGggZD0ibTEzNy45NDU4MjggMjgxLjE5MjQ1Mi04LjQ5MDU2Ni05Lj43MTY5ODEgNTUuMzg5NjIzLTkuNzE2OTgxIDUuMzAxODg4IDEyLjg0OTA1N3oiIGZpbGw9IiMzOTM5MzkiLz48cGF0aCBkPSJtMTg2LjA3MzU4NCAyODEuMTkyNDUyIDguNDkwNTY2LTkuNzE2OTgxLTU1LjM4OTYyMy05LjcxNjk4MS01LjMwMTg4NyAxMi44NDkwNTd6IiBmaWxsPSIjMzkzOTM5IiB0cmFuc2Zvcm09Im1hdHJpeCgtMSAwIDAgMSAzODAuNjM5IDApIi8+PHBhdGggZD0ibTE0NC41MTg4NjggMjE0Ljk2MjI2NC04Ljg0NzAzOSAxNi4yNzk4MTIgOC44NDcwMzkgMTcuNjgyMTg4IDEzLjIzNTg0OS0xLjQwNTY0MyAzLjM5OTY4My05Ljk5Njc5NyAyLjE2NjAzOC0xMy43MDg2MTUtMzEuMzQ1NjQxLTI0Ljk0OTYyMXoiIGZpbGw9IiNmODlkMzUiLz48cGF0aCBkPSJtNDkuNDE1MDk0IDUyLjgzMTUzMyA5NC41NDMzOTYgNzAuNzE2OTgxLS45MzUzNzcgNi4zMjIwMzItNC44MjA3NTQtNy41MzI2NzggMS40NTI4MzEgNC41MTkwMzQtMjQuOTEzMjA4IDI0Ljc4OTU5IDQuMjQ1MjgzIDEuMjMzMDUtMTMuNzkxNzE3IDEyLjUwNjYwNy0xNS43MTkyNy0zLjgxNjMzMy0yMC42NTc1MTQtMTQuNTQ3OTE2IDEuMzE0NzE2LTMuNDY1Njg1eiIgZmlsbD0iI2Y4OWQzNSIvPjxwYXRoIGQ9Im0MTc3LjIwNDMwMiAyMTQuOTYyMjY0IDguODQ3MDM4IDE2LjI3OTgxMi04Ljg0NzAzOCAxNy42ODIxODgtMTMuMjM1ODUtMS40MDU2NDMtMy4zOTk2ODMtOS45OTY3OTctMi4xNjYwMzctMTMuNzA4NjE1IDMxLjM0NTY0MS0yNC45NDk2MjF6IiBmaWxsPSIjZjg5ZDM1IiB0cmFuc2Zvcm09Im1hdHJpeCgtMSAwIDAgMSAzNzEuMjI2IDApIi8+PHBhdGggZD0ibTI3NC40NTI4MyA1Mi44MzE1MzMtOTQuNTQzMzk2IDcwLjcxNjk4MS45MzUzNzcgNi4zMjIwMzIgNC44MjA3NTQtNy41MzI2NzgtMS40NTI4MzEgNC41MTkwMzQgMjQuOTEzMjA4IDI0Ljc4OTU5LTQuMjQ1MjgzIDEuMjMzMDUgMTMuNzkxNzE3IDEyLjUwNjYwNyAxNS43MTkyNjktMy44MTYzMzMgMjAuNjU3NTE1LTE0LjU0NzkxNi0xLjMxNDcxNy0zLjQ2NTY4NXoiIGZpbGw9IiNmODlkMzUiIHRyYW5zZm9ybT0ibWF0cml4KC0xIDAgMCAxIDUwMS40MDYgMCkiLz48cGF0aCBkPSJtNTAuMTEzMjA4IDE4Ny43NzUyODIgMTEuMDM3NzM2IDI1LjE0MjY3NmgtMTEuMDM3NzM2eiIgZmlsbD0iI2Q4N2MzMCIvPjxwYXRoIGQ9Im03MC41MTA4NDkgMTg3Ljc3NTI4MiAxMS4wMzc3MzYgMjUuMTQyNjc2aC0xMS4wMzc3MzZ6IiBmaWxsPSIjZWE4ZDNhIi8+PHBhdGggZD0ibTg5LjcxNjk4MSAxODcuNzc1MjgyIDEwLjgwOTQzNCAyNS4xNDI2NzZoLTEwLjgwOTQzNHoiIGZpbGw9IiNmODlkMzUiLz48cGF0aCBkPSJtMTAzLjI0MDU2NiAxODcuNzc1MjgyIDEwLjgwOTQzNCAyNS4xNDI2NzZoLTEwLjgwOTQzNHoiIGZpbGw9IiNkODdjMzAiLz48cGF0aCBkPSJtMTE2Ljc2NDE1MSAxODcuNzc1MjgyIDEwLjgwOTQzNCAyNS4xNDI2NzZoLTEwLjgwOTQzNHoiIGZpbGw9IiNlYjhmMzUiLz48cGF0aCBkPSJtMTMxLjM4Nj3OTIgMTg3Ljc3NTI4MiAxMC44MDk0MzQgMjUuMTQyNjc2aC0xMC44MDk0MzR6IiBmaWxsPSIjZTg4ZjNhIi8+PHBhdGggZD0ibTE0Ni45MTg4NjggMTg3Ljc3NTI4MiAxMC42MzQ5MDYgMjUuMTQyNjc2aC0xMC42MzQ5MDZ6IiBmaWxsPSIjOGU1YTMwIi8+PHBhdGggZD0ibTI2MC41NjYwMzggMTQwLjgzOTU2OCA1Mi41MTU2NiA0Ni43NTQwMjR6IiBmaWxsPSIjZjg5ZDM1Ii8+PHBhdGggZD0ibTI1OC4xODg2OCAxNTAuOTY4NTkzbDMuNjkyNDUyIDIyLjA3MzU4NS0yMC45MDA5NCAxOC45NjEzNjh6IiBmaWxsPSIjZDg3YzMwIi8+PHBhdGggZD0ibTI1OC4xODg2OCAxNTAuOTY4NTkzIDIwLjIxNjk4MSAxOC42NjA0MTYtMjMuNzMxMTMyIDIyLjM3NDUzN3oiIGZpbGw9IiNlYThhM2EiLz48cGF0aCBkPSJtMjM0LjQ1NzU0NyAxNzMuMDM0MDA5IDIzLjczMTEzMy0yMi4wNjU0MTYtMy44OTE1MDkgNDkuNjg5NTcxek0yMzQuNDU3NTQ3IDE3My4wMzQwMDlsMTkuNzkwNTY2IDI3LjYyNDE1NXYxMC43OTQzNDF6bTU0LjI0NTI4My01LjczNDkwNi0xMC44MTI5MjUgNDQuOTUyODExdi00NC45NTI4MTF6bS0xMy43NzU4OTYgMTkuNzkwNTY2djM5LjIxNjk4MWwtMTAuODEyOTI1LTM5LjIxNjk4MXptLTEwLjc2NDE1MSAzOS4yMTY5ODEtOS44OTIwNzUtMTEuMDM3NzM2em0tOS44OTIwNzUtMTEuMDM3NzM2djI3LjE1MDk0M2wtOS44OTE1MDktMTkuNjEwMzc3em0wIDIxLjAwODQ1OHYxNS40NzY0MTVsLTkuODkxNTA5IDUuNzM0OTA2em0tOS44OTE1MDkgMjEuMjExMzIxdi0xNy42MzkyNjRsOS44OTE1MDktMjcuMTUwOTQ0em0zOS4zMjA3NTUtMzMuNTgzMDE5IDEwLjgxMjkyNSAxMS4yNjk4MTF6bTEwLjgxMjkyNSAxMS4yNjk4MTFoOS44OTIwNzVsLTIuNTk0MzQgMy40NjU2ODV6bTkuODkyMDc1IDAtMTkuNzg0OTU2IDMyLjc1NDcxN3YtMzIuNzU0NzE3em0wIDAtMi40NzE2OTggMy40NjU2ODUtNy40MTUwOTQtMy40NjU2ODV6IiBmaWxsPSIjZjg5ZDM1Ii8+PHBhdGggZD0ibTI0MC45ODA1NjYgMjEyLjkxNzY0NyA5Ljg5MTUwOS0xOS42MTAzNzcgMi44MzAxOSA3NC40MDcyNjl6IiBmaWxsPSIjZWI4ZjM1Ii8+PHBhdGggZD0ibTI0MC45ODA1NjYgMjEyLjkxNzY0Ny0xMy4wNjk4MTIgNjIuNjU0MjQ1di0zNS40Mzk2MjN6IiBmaWxsPSIjZWE4ZDNhIi8+PHBhdGggZD0ibTIyNy45MTA3NTUgMjQwLjA2ODUzOCAyLjU5NDMzOS0yNy4xNTA4OTEgMTAuNDc1NDcyIDcuNTMzNzMyek0yODMuMDE4ODY4IDE5NS4yNzgyODNsNy4yNDUyODMgNDEuNDMzOTYzeiIgZmlsbD0iI2Y4OWQzNSIvPjxwYXRoIGQ9Im0yOTAuMjY0MTUxIDIzNi43MTIyNDYtNy4yNDUyODMtNDEuNDMzOTYzIDEwLjQ5ODExMy0xMS43MDMzMDJ6IiBmaWxsPSIjZDg3YzMwIi8+PHBhdGggZD0ibTI0MC45ODA1NjYgMjEyLjkxNzY0NyAzOS4yNDE1MDkgMjMuNzkwOTE1eiIgZmlsbD0iI2ViOGYzNSIvPjxwYXRoIGQ9Im0yNTMuNzE2OTgxIDIxMy4xNTI0MjUgMjYuNTA0NzE3IDIzLjU1OTA0NnoiIGZpbGw9IiNlODhmM2EiLz48cGF0aCBkPSJtMzAuOTg0OTA2IDE4NS45NTk1NDcgMi40MjY5ODEgMzAuNjE4ODY4eiIgZmlsbD0iI2ViOGYzNSIvPjxwYXRoIGQ9Im0zMC45ODQ5MDYgMTg1Ljk1OTU0NyAxOC44Mzc3MzYgMzAuNjE4ODY4eiIgZmlsbD0iI2U4OGYzYSIvPjxwYXRoIGQ9Im0zMy40MTE4ODcgMjE2LjU3ODQxNSA5Ljg5MTUwOS0xOS42MTAzNzctNC40NTI4MzEgNzQuNDA3MjY5ek0zMy40MTE4ODcgMjE2LjU3ODQxNWwyNy42MjY0MTUgNTguNzM1NDcydi0zNS40Mzk2MjN6IiBmaWxsPSIjZjg5ZDM1Ii8+PHBhdGggZD0ibTYxLjAzODMwMiAyMzkuODc0Mzg5LTI3LjYyNjQxNS0yMy4yOTU5NzQgMTAuNDc1NDcxIDcuNTMzNzMyeiIgZmlsbD0iI2ViOGYzNSIvPjxwYXRoIGQ9Im0zMy40MTE4ODcgMjE2LjU3ODQxNSAxMC40NzU0NzEgNy41MzM3MzItMi44MzAxOSA0Ny4yNjI3NHptLTkuODkxNTA5LTE5LjYxMDM3NyA5Ljg5MTUwOS03My4xNzUyODN6IiBmaWxsPSIjZDg3YzMwIi8+PHBhdGggZD0ibTMzLjQxMTg4NyAxMjMuNzkzMDM2IDEwLjQ3NTQ3MSA3My4xNzUyODN6IiBmaWxsPSIjZWI4ZjM1Ii8+PHBhdGggZD0ibTQzLjg4NzM1OCAxOTYuOTY4MzE5IDI3LjYyNjQxNSAxMC43OTQzNDF2MzIuMjc1NDI1em0wIDAtOS44OTIwNzUtMTkuNjEwMzc3IDE5Ljc4NDk1NiAxOS42MTAzNzd6IiBmaWxsPSIjZTg4ZjNhIi8+PHBhdGggZD0ibTQzLjg4NzM1OCAxOTYuOTY4MzE5IDE5Ljc4NDk1NiAxOS42MTAzNzctOS44OTE1MDggMjMuNDU5Njk3eiIgZmlsbD0iI2Y4OWQzNSIvPjxwYXRoIGQ9Im0zMy40MTE4ODcgMjE2LjU3ODQxNSA0MC4yNjQxNTEtNTMuMTEzMjA4ek00My44ODczNTggMTk2Ljk2ODMxOWgxOS43ODQ5NTZ6IiBmaWxsPSIjZjg5ZDM1Ii8+PHBhdGggZD0ibTUzLjc4MTE5MiAxMTYuNTEzMjA3IDE1LjczMTEzMy04NC4xOTgxMTI2IDMuNjkyNDUzIDkxLjY3NDUyODZ6bS05LjA0NzE3IDcuMjc5ODI5IDE1LjcyNDg3Ny04NC4xOTgxMTI2IDE1LjczMTEzMyA4NC4xOTgxMTI2em0tMTAuMzIwNzU1IDcyLjgyNTY2MSAyOS43MTY5ODEtNzIuODI1NjYxeiIgZmlsbD0iI2U4OGYzYSIvPjxwYXRoIGQ9Im03MS41MTMyNjQgMTYzLjQ2NTQ0IDQ2Ljc1NDcxNy03OS4wNjYwMzhoMTMuNzg4Njc5bC0yMC4yMDM3NzQgMzkuMzg2Nzk0IDIzLjczMDk0NCAyMi4wNjU0MTZ6IiBmaWxsPSIjZjg5ZDM1Ii8+PHBhdGggZD0ibTMzLjQxMTg4NyAyMTYuNTc4NDE1IDEwLjM2MTMyMS0zLjY5MjQ1MyAyMC4yNDE1MDktMjcuMTUwOTQzem0xMTUuMjgyNzM2IDI1LjE0MjY3N3YtMjguMzg2NzkzbDguNDkwNTY2IDI3LjE1MDk0MyA1Ljk0NzE3IDEuMjM1ODV6bTguNDkwNTY2LTI1LjE0MjY3Ny0xOC42OTgxMTQtMjIuNzU1OTYxIDI4LjM5NjIyNiA0Ni43NTQ3MTd6bS0xOS4xNTg0OTEtMTQuNjU4NzY1LTI3LjYzNjc5Mi05LjA2MDM3NiA5Ljg5MTUwOSAxNi44OTQwMTZ6IiBmaWxsPSIjZDg3YzMwIi8+PHBhdGggZD0ibTcxLjUxMzI2NCAxNjMuNDY1NDQtMjcuNjM2NzkyLTkuMDYwMzc2IDguNDkwNTY2LTMwLjYxMTMyMSAzOC4yMDc1NDggMjkuNjA4MzM5eiIgZmlsbD0iI2ViOGYzNSIvPjxwYXRoIGQ9Im02MS4wMzgzMDIgMjM5Ljg3NDM4OS0xNi4xNTk0MzQgMzUuNDMwNzczIDU5LjQzOTYyMy0xNi4yMjQ1OTZ6IiBmaWxsPSIjZDg3YzMwIi8+PHBhdGggZD0ibTEyNS41ODI1NDcgMjY0LjU2NDQzNC01OS40Mzk2MjMgMTYuMjI0NTk2IDM4LjIwNzU0OC0yMS42MDM3NzR6bS0zNC4zMTEzMjEgMTAuNTg0OTA2IDE5Ljc4NDk1Ni00My4yNzU0NzEgMTEuMDM3NzM2IDQyLjAzOTYyMnoiIGZpbGw9IiNlYjhmMzUiLz48cGF0aCBkPSJtMTQxLjQ4MTEzMiAyMTAuNDY2MDM4IDE5Ljc4NDk1Ny00My4yNzU0NzItMTEuMDM3NzM2IDQyLjAzOTYyM3ptLTE5Ljc4NDk1Ny00My4yNzU0NzEgMTkuNzg0OTU3IDQzLjI3NTQ3MS0xOS43ODQ5NTctNC44MTA4NDl6IiBmaWxsPSIjZTg4ZjNhIi8+PHBhdGggZD0ibTExNi43NjQxNTEgMjEyLjkxNzY0NyA0LjkyNDUyOCA0OS43NjYwMzggMTkuNzk0MzQtNTMuNTA2MDE4em0yNC43MTg4NjgtMy42ODg2NzkgMTkuNzg0OTU3IDQzLjI3NTQ3MS0xOS43ODQ5NTctNDMuMjc1NDcxek0xMjAuNzkzOTYyIDg2LjE2MzMzNzJsMTYuMjU1NjU3LTg0LjE5ODExMjYgNy4yNDUyODMgMzkuMzg2NzkzOC0xMy4yMzU4NDkgNDAuNjE4ODY3OXoiIGZpbGw9IiNlODhmM2EiLz48cGF0aCBkPSJtNjEuMDM4MzAyIDIzOS44NzQzODkgNDMuODg2NzkyLTMzLjIzNTg0OS0xMS4wMzc3MzYtMzkuMTc0NTY3em0zMi44NDkwNTYtMjA2LjcxMDcyMzYgMTguOTczNTg1IDg0LjE5ODExMjYtMTMuMjM1ODQ5LTM1LjE3OTI0NTN6bS00Ni43NTQ3MTggNzkuMjgzMDE5NiAxMy43ODg2NzkgODQuMTk0MzM5di0xNi45OTk2MjN6IiBmaWxsPSIjZjg5ZDM1Ii8+PHBhdGggZD0ibTQzLjg4NzM1OCAxOTYuOTY4MzE5IDkuODkxNTA5IDM3LjA5MjQ1NHYxNi45OTk2MjN6IiBmaWxsPSIjZGY5OTMzIi8+PHBhdGggZD0ibTYxLjAzODMwMiAyMzkuODc0Mzg5IDQzLjg4Njc5Mi0zMy4yMzU4NDktOS44OTE1MDktMjkuNjU5NjIzem0tNDMuMDA3NTQ3LTExNi42OTgxMTQgNzIuMzcxNjk4IDQ2Ljc1NDcxOHYxMy43OTA1NjZ6IiBmaWxsPSIjZTg4ZjNhIi8+PHBhdGggZD0ibTQzLjg4NzM1OCAxOTYuOTY4MzE5IDI3LjYzNjc5MiA5LjA2MDM3Ny0yLjgzMDE5IDMzLjg0NTY5M3ptMjcuNjM2NzkyIDkuMDYwMzc3IDI4LjQwNTY2IDYuMTMxMTMzIDMuNDE4ODY5IDI3LjcxNDQ4em0tOC40OTA1NjYtMzkuNTA5NDE1IDI4LjM5NjIyNyAxLjIzNTg1di0xMy43OTA1NjZ6IiBmaWxsPSIjZjg5ZDM1Ii8+PHBhdGggZD0ibTQ5LjgyNDUyOCAxODAuMDU1NDczIDIxLjYwOTQzNC0xMy41MTg4Njd2MTMuNDkwNTY2ek02OS40MzM5NjIgMTY3LjY1MzczNmwtMTguNjk4MTEzLTQuMTg4Njc5IDQ2Ljc1NDcxNyAxNy41NDcxN3oiIGZpbGw9IiNmODlkMzUiLz48L2c+PC9zdmc+"
                        alt="MetaMask"
                        className="w-5 h-5"
                    />
                    <span>{isConnecting ? 'Connecting...' : 'Connect MetaMask'}</span>
                </button>
            ) : (
                <div className="text-sm text-gray-600 dark:text-gray-400 text-center">
                    <p className="mb-2">MetaMask not detected</p>
                    <a
                        href="https://metamask.io/download/"
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-primary-600 hover:text-primary-700 underline"
                    >
                        Install MetaMask
                    </a>
                </div>
            )}

            {error && (
                <div className="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3">
                    <p className="text-sm text-red-800 dark:text-red-200">{error}</p>
                </div>
            )}
        </div>
    );
}
